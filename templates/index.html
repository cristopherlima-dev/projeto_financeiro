{% extends "base.html" %} 

{% block title %}Dashboard Pro{% endblock %} 

{% block content %}

<style>
    /* No Mobile: Permite rolagem horizontal */
    .mobile-tabs-wrapper {
        width: 100%;
        overflow-x: auto;
        -webkit-overflow-scrolling: touch; /* Rolagem suave no iOS */
        padding-bottom: 5px; /* Espa√ßo para a barra n√£o colar no texto */
    }

    /* No Desktop (acima de 768px): Remove a barra de rolagem */
    @media (min-width: 768px) {
        .mobile-tabs-wrapper {
            overflow-x: visible !important;
            width: auto;
            padding-bottom: 0;
        }
    }
</style>

<div class="d-flex flex-column flex-md-row justify-content-between align-items-center mb-3 gap-2">
  
  <div class="mobile-tabs-wrapper">
    <ul class="nav nav-tabs border-0 flex-nowrap" id="myTab" role="tablist">
        <li class="nav-item">
            <button class="nav-link active fw-bold text-nowrap" data-bs-toggle="tab" data-bs-target="#dashboard-pane">
                üìä Dashboard
            </button>
        </li>
        <li class="nav-item">
            <button class="nav-link fw-bold text-nowrap" data-bs-toggle="tab" data-bs-target="#lancamentos-pane">
                üìù Lan√ßamentos
            </button>
        </li>
        <li class="nav-item">
            <button class="nav-link fw-bold text-nowrap" data-bs-toggle="tab" data-bs-target="#vencimentos-pane">
                ‚è∞ Vencimentos
            </button>
        </li>
        <li class="nav-item">
            <button class="nav-link fw-bold text-nowrap" data-bs-toggle="tab" data-bs-target="#planejamento-pane" onclick="carregarPlanejamento()">
                üìÖ Planejamento Anual
            </button>
        </li>
    </ul>
  </div>

  <div class="d-flex gap-2 w-100 w-md-auto justify-content-end mt-2 mt-md-0">
      <button class="btn btn-light border text-secondary shadow-sm flex-fill flex-md-grow-0" data-bs-toggle="modal" data-bs-target="#modalConfig" title="Configura√ß√µes">
          <i class="fa-solid fa-gear"></i>
      </button>
      <button class="btn btn-light border text-secondary shadow-sm flex-fill flex-md-grow-0" data-bs-toggle="modal" data-bs-target="#modalManutencao" title="Manuten√ß√£o e Backup">
          <i class="fa-solid fa-screwdriver-wrench"></i>
      </button>
  </div>

</div>

<div class="tab-content">
  
  <div class="tab-pane fade show active" id="dashboard-pane">
    <div class="row g-2 mb-4">
      
      <div class="col-12 col-md-4">
        <div class="card bg-primary text-white h-100 shadow-sm text-center">
          <div class="card-body p-3">
            <small><i class="fa-solid fa-building-columns"></i> Saldo Dispon√≠vel</small>
            <h3 id="card-saldo-disp" class="fw-bold mt-2">R$ 0,00</h3>
            <small class="opacity-75" style="font-size: 0.7em;">Bancos + Carteira + Vales</small>
          </div>
        </div>
      </div>

      <div class="col-12 col-md-4">
        <div class="card bg-warning text-dark h-100 shadow-sm position-relative text-center">
          <div class="card-body p-3">
            <small><i class="fa-solid fa-credit-card"></i> Fatura Atual</small>
            <h3 id="card-fatura" class="fw-bold mt-2">R$ 0,00</h3>
            <button class="btn btn-sm btn-dark w-100 mt-2 shadow-sm" onclick="abrirModalPagamento()">
                <i class="fa-solid fa-money-bill-wave"></i> Pagar Fatura
            </button>
          </div>
        </div>
      </div>

      <div class="col-12 col-md-4">
        <div class="card bg-dark text-white h-100 shadow-sm border-0">
          <div class="card-body p-2 d-flex flex-row justify-content-between align-items-center text-center">
            <div class="flex-fill"><small class="text-success fw-bold d-block">Entradas</small><span id="card-ent-geral" class="fw-bold">R$ 0,00</span></div>
            <div class="vr bg-secondary opacity-50 mx-1"></div>
            <div class="flex-fill"><small class="text-danger fw-bold d-block">Sa√≠das</small><span id="card-sai-geral" class="fw-bold">R$ 0,00</span></div>
             <div class="vr bg-secondary opacity-50 mx-1"></div>
            <div class="flex-fill"><small class="text-info fw-bold d-block">Final</small><span id="card-saldo-final" class="fw-bold">R$ 0,00</span></div>
          </div>
        </div>
      </div>
    </div>

    <h6 class="fw-bold text-primary border-bottom pb-2">‚öñÔ∏è Balan√ßo Mensal</h6>
    <div class="row mb-4 justify-content-center">
      <div class="col-md-6">
        <div class="card shadow-sm">
          <div class="card-header small">Entradas vs Sa√≠das (Efetivadas)</div>
          <div class="card-body" style="height: 300px"><canvas id="chartBalanco"></canvas></div>
        </div>
      </div>
    </div>

    <h6 class="fw-bold text-success border-bottom pb-2">üí∞ An√°lise de Entradas</h6>
    <div class="row mb-4">
      <div class="col-md-6 mb-3 mb-md-0"><div class="card shadow-sm h-100"><div class="card-header small">Por Subtipo</div><div class="card-body"><canvas id="chartEntSub"></canvas></div></div></div>
      <div class="col-md-6"><div class="card shadow-sm h-100"><div class="card-header small">Por Categoria</div><div class="card-body"><canvas id="chartEntCat"></canvas></div></div></div>
    </div>

    <h6 class="fw-bold text-danger border-bottom pb-2">üí∏ An√°lise de Sa√≠das</h6>
    <div class="row mb-5">
      <div class="col-md-6 mb-3 mb-md-0"><div class="card shadow-sm h-100"><div class="card-header small">Por Subtipo</div><div class="card-body"><canvas id="chartSaiSub"></canvas></div></div></div>
      <div class="col-md-6"><div class="card shadow-sm h-100"><div class="card-header small">Por Categoria</div><div class="card-body"><canvas id="chartSaiCat"></canvas></div></div></div>
    </div>
  </div>

  <div class="tab-pane fade" id="lancamentos-pane">
    <div class="d-flex justify-content-between mb-3">
      <h5>Hist√≥rico</h5>
      <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalLancamento" onclick="prepararModal()">+ Novo</button>
    </div>
    <div class="table-responsive shadow-sm rounded" style="max-height: 70vh;">
      <table class="table table-hover mb-0 bg-white align-middle small table-sm">
        <thead class="table-light sticky-top">
          <tr>
            <th>St</th> <th>Data</th>
            <th>Conta</th>
            <th>Desc.</th> <th class="d-none d-md-table-cell">Tipo</th> <th class="d-none d-md-table-cell">Subtipo</th> <th class="d-none d-sm-table-cell">Cat.</th> <th>Valor</th>
            <th>A√ß√£o</th>
          </tr>
        </thead>
        <tbody id="tabela-lancamentos-body"></tbody>
      </table>
    </div>
  </div>

  <div class="tab-pane fade" id="vencimentos-pane">
    <div class="d-flex justify-content-between mb-3">
      <h5>Vencimentos</h5>
      <button class="btn btn-warning" data-bs-toggle="modal" data-bs-target="#modalVencimento">+ Alerta</button>
    </div>
    <div class="table-responsive shadow-sm rounded">
      <table class="table table-hover bg-white align-middle">
        <thead><tr><th>Descri√ß√£o</th><th>Tipo</th><th>Data</th><th>Ativo</th><th>A√ß√£o</th></tr></thead>
        <tbody id="tabela-vencimentos-body"></tbody>
      </table>
    </div>
  </div>

  <div class="tab-pane fade" id="planejamento-pane">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h5>üìÖ Vis√£o Anual por Categoria</h5>
      <div class="d-flex gap-2 align-items-center">
        <label class="fw-bold">Ano:</label>
        <select id="filtro-ano-plan" class="form-select form-select-sm w-auto" onchange="carregarPlanejamento()"></select>
      </div>
    </div>
    <div class="table-responsive shadow-sm rounded bg-white">
      <table class="table table-bordered table-hover mb-0 small text-center align-middle" id="tabela-planejamento">
        <thead class="table-dark">
          <tr>
            <th class="text-start" style="min-width: 150px">Categoria</th>
            <th>Jan</th><th>Fev</th><th>Mar</th><th>Abr</th><th>Mai</th><th>Jun</th><th>Jul</th><th>Ago</th><th>Set</th><th>Out</th><th>Nov</th><th>Dez</th><th class="bg-secondary">Total</th>
          </tr>
        </thead>
        <tbody id="tbody-planejamento"></tbody>
      </table>
    </div>
  </div>
</div>

<div class="modal fade" id="modalPagamentoFatura" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header bg-warning-subtle">
          <h5 class="modal-title fw-bold"><i class="fa-solid fa-credit-card"></i> Pagar Fatura</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <form id="form-pagar-fatura">
            
            <div class="mb-3">
                <label class="form-label fw-bold">Qual cart√£o voc√™ vai pagar?</label>
                <select id="pag-cartao-destino" class="form-select" required></select>
            </div>

            <div class="mb-3">
                <label class="form-label fw-bold">De onde sai o dinheiro?</label>
                <select id="pag-conta-origem" class="form-select" required></select>
            </div>

            <div class="row g-2">
                <div class="col-6">
                    <label class="form-label">Data do Pagamento</label>
                    <input type="date" id="pag-data" class="form-control" required>
                </div>
                <div class="col-6">
                    <label class="form-label">Valor (R$)</label>
                    <input type="number" id="pag-valor" step="0.01" class="form-control" required>
                </div>
            </div>

            <div class="alert alert-light border mt-3 small text-muted">
                <i class="fa-solid fa-circle-info"></i> Isso criar√° automaticamente uma <b>Sa√≠da</b> na conta de origem e uma <b>Entrada</b> no cart√£o para zerar a fatura.
            </div>

            <div class="modal-footer px-0 pb-0">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
              <button type="submit" class="btn btn-dark fw-bold">Confirmar Pagamento</button>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

{% include 'components/modal_config.html' %} 
{% include 'components/modal_vencimento.html' %} 
{% include 'components/modal_categorias.html' %} 
{% include 'components/modal.html' %} 
{% include 'components/modal_manutencao.html' %}
{% include 'components/modal_feedback.html' %}

{% endblock %}